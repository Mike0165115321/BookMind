# üìò ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö RAG ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
# RAG System ‚Äî Technical Documentation (v2.0)

> ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö RAG (Retrieval-Augmented Generation) **‡πÅ‡∏ö‡∏ö End-to-End** ‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô
> ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà Query Transform (HyDE), Hybrid Search, Adaptive Reranking, LLM Generation (Gemini), ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á Web UI

---

## ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç

1. [‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö](#1-‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö)
2. [Data Pipeline ‚Äî ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•](#2-data-pipeline--‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
3. [Chunking ‚Äî ‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£](#3-chunking--‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£)
4. [Embedding ‚Äî ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô Vector](#4-embedding--‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô-vector)
5. [FAISS Index ‚Äî ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Vector](#5-faiss-index--‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•-vector)
6. [BM25 ‚Äî Keyword Search](#6-bm25--keyword-search)
7. [Hybrid Search ‚Äî ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏ú‡∏™‡∏°](#7-hybrid-search--‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏ú‡∏™‡∏°)
8. [Reranker + Adaptive Reranking ‚Äî ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ã‡πâ‡∏≥‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞](#8-reranker--adaptive-reranking--‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ã‡πâ‡∏≥‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞)
9. [Search Pipeline ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°](#9-search-pipeline-‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°)
10. [HyDE ‚Äî Query Transform](#10-hyde--query-transform)
11. [LLM Generation ‚Äî Gemini](#11-llm-generation--gemini)
12. [Core Package ‚Äî API Keys & Modules](#12-core-package--api-keys--modules)
13. [Web UI ‚Äî FastAPI + SSE](#13-web-ui--fastapi--sse)
14. [‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà](#14-‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà)
15. [Configuration ‚Äî ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤](#15-configuration--‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤)
16. [‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (VRAM/RAM)](#16-‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ-vramram)
17. [‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏°‡πÄ‡∏î‡∏• AI](#17-‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏°‡πÄ‡∏î‡∏•-ai)
18. [Flow Chart ‚Äî ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô](#18-flow-chart--‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô)

---

## 1. ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö

### RAG ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**RAG (Retrieval-Augmented Generation)** ‡∏Ñ‡∏∑‡∏≠‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏° AI ‡∏ó‡∏µ‡πà‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏Å:

1. **Retrieval (‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤):** ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ
2. **Generation (‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö):** ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡πÄ‡∏à‡∏≠‡πÉ‡∏´‡πâ LLM ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö

> ‚úÖ **‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô** ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á Retrieval + Generation (Full RAG Pipeline v2.0)
> HyDE (Groq) ‚Üí Hybrid Search ‚Üí Adaptive Reranking ‚Üí Gemini Generation ‚Üí Web UI

### ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á RAG?

| ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏≠‡∏á LLM ‡∏õ‡∏Å‡∏ï‡∏¥ | RAG ‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£ |
|-------------------|-----------------|
| ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤ (training cutoff) | ‡∏Ñ‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏î‡πâ |
| ‡∏´‡∏•‡∏≠‡∏ô (Hallucination) | ‡∏°‡∏µ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏£‡∏¥‡∏á |
| ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á | ‡∏Ñ‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß |
| ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏• | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô |

---

## 2. Data Pipeline ‚Äî ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á

‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `data/` ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå `.jsonl` (JSON Lines) ‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î = ‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (.jsonl):**
```json
{
  "book_title": "Atomic Habits",
  "title": "‡∏Å‡∏é‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô",
  "content": "‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏¥‡πà‡∏á‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô..."
}
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

```
data/
‚îú‚îÄ‚îÄ atomic_habits.jsonl     ‚Üí ‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î
‚îú‚îÄ‚îÄ three_kingdoms.jsonl    ‚Üí ‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î
‚îú‚îÄ‚îÄ rich_dad.jsonl          ‚Üí ‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î
‚îî‚îÄ‚îÄ ... (120 ‡πÑ‡∏ü‡∏•‡πå)
```

**‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£:**
1. ‡∏ß‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡πÑ‡∏ü‡∏•‡πå `.jsonl` ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `data/`
2. ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î parse ‡πÄ‡∏õ‡πá‡∏ô JSON
3. ‡∏î‡∏∂‡∏á 3 field ‡∏°‡∏≤‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô:
   - `book_title` ‚Üí ‡πÅ‡∏ó‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô `[Atomic Habits]`
   - `title` ‚Üí ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢
   - `content` ‚Üí ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å
4. ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Chunking pipeline

**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á:** `rag_creator.py` ‚Üí method `_load_jsonl()`

---

## 3. Chunking ‚Äî ‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£

### ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á Chunk?

Embedding model (e5-large) ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏ô‡∏≤‡∏î **~500 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£** ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ:
- Model ‡∏à‡∏∞ "‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢" ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏ô‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏à‡∏∏‡∏î (‡πÄ‡∏à‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà "‡∏û‡∏≠‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß" ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á)

‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ:
- ‡∏Ç‡∏≤‡∏î‡∏ö‡∏£‡∏¥‡∏ö‡∏ó ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢

### Chunking Strategy ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö

```
‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö (‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ 1 entry ‡πÉ‡∏ô JSONL):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ [Atomic Habits]                                 ‚îÇ
‚îÇ ‡∏Å‡∏é‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô                        ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏¥‡πà‡∏á‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô   ‚îÇ
‚îÇ ‡∏ô‡∏±‡πâ‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠...                   ‚îÇ
‚îÇ (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß 2,000 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚ñº  Chunker (500 chars, overlap 100)
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Chunk 1 (500 chars)             ‚îÇ
    ‚îÇ [Atomic Habits]                 ‚îÇ
    ‚îÇ ‡∏Å‡∏é‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô       ‚îÇ
    ‚îÇ ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô...     ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚óÑ‚îÄ‚îÄ overlap 100 chars     ‚îÇ
    ‚îÇ Chunk 2 (500 chars)             ‚îÇ
    ‚îÇ [Atomic Habits]                 ‚îÇ
    ‚îÇ ...‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏¥‡πà‡∏á‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏ô‡∏±‡πâ‡∏ô  ‚îÇ
    ‚îÇ ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠...      ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚óÑ‚îÄ‚îÄ overlap 100 chars     ‚îÇ
    ‚îÇ Chunk 3 (500 chars)             ‚îÇ
    ‚îÇ [Atomic Habits]                 ‚îÇ
    ‚îÇ ...‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ implementation ‚îÇ
    ‚îÇ intention ‡πÇ‡∏î‡∏¢‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤...          ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î

1. **‡∏ï‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ (`\n`)** ‚Äî ‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÑ‡∏°‡πà‡∏ï‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î
2. **‡∏ï‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡∏à‡∏ö‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ (`.` `„ÄÇ` `!` `?`)** ‚Äî ‡∏ñ‡πâ‡∏≤‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô
3. **‡∏ï‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£** ‚Äî ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏ï‡∏±‡∏î‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥

### Overlap ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**Overlap** = ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á chunk ‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô

```
Chunk 1: [AAAAAAAAAA|BBBB]
                     ‚Üï overlap 100 chars
Chunk 2:            [BBBB|CCCCCCCCCC]
```

**‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Overlap?**
- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢" ‡∏ï‡∏£‡∏á‡∏£‡∏≠‡∏¢‡∏ï‡∏±‡∏î
- ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏£‡∏≠‡∏¢‡∏ï‡πà‡∏≠‡∏û‡∏≠‡∏î‡∏µ ‚Üí ‡∏¢‡∏±‡∏á‡πÄ‡∏à‡∏≠‡πÉ‡∏ô chunk ‡πÉ‡∏î‡πÄ‡∏ä‡πà‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á

### Metadata Prefix

‡∏ó‡∏∏‡∏Å chunk ‡∏à‡∏∞‡∏°‡∏µ **‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ + ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠** ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏™‡∏°‡∏≠:

```
[Atomic Habits]              ‚Üê book_title
‡∏Å‡∏é‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô    ‚Üê title
‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô...  ‚Üê content (chunked)
```

‡∏™‡∏¥‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ:
- Embedding ‡∏à‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏ö‡∏ó "‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡πà‡∏°‡πÑ‡∏´‡∏ô" ‡πÑ‡∏î‡πâ
- BM25 ‡∏Ñ‡πâ‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ï‡∏£‡∏á‡πÜ ‡πÑ‡∏î‡πâ

**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á:** `rag_creator.py` ‚Üí class `TextChunker`

**‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á:** `config.py` ‚Üí `CHUNK_SIZE = 500`, `CHUNK_OVERLAP = 100`

---

## 4. Embedding ‚Äî ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô Vector

### ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£

**Embedding** ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô "‡πÄ‡∏ß‡∏Å‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç" ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢

```
"‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏µ"  ‚Üí  [0.0234, -0.1456, 0.3421, ..., 0.0891]
                            (1,024 ‡∏°‡∏¥‡∏ï‡∏¥)
```

‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô ‚Üí ‡∏à‡∏∞‡∏°‡∏µ vector ‡∏ó‡∏µ‡πà‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô:

```
"‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏µ"        ‚Üí [0.82, 0.34, ...]  ‚îÄ‚îê
"‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô"  ‚Üí [0.80, 0.31, ...]  ‚îÄ‚î§ ‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ô!
                                                    ‚îÇ
"‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ"          ‚Üí [-0.12, 0.95, ...] ‚îÄ‚îò ‡πÑ‡∏Å‡∏•‡∏°‡∏≤‡∏Å!
```

### ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: `intfloat/multilingual-e5-large`

| ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥ | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
|-----------|-----------|
| Parameters | ~560 ‡∏•‡πâ‡∏≤‡∏ô |
| Dimension | 1,024 |
| ‡∏†‡∏≤‡∏©‡∏≤ | 100+ ‡∏†‡∏≤‡∏©‡∏≤ (‡∏£‡∏ß‡∏°‡πÑ‡∏ó‡∏¢) |
| Benchmark | MTEB Top-tier |
| ‡∏Ç‡∏ô‡∏≤‡∏î | ~2.2 GB |

### üéì Deep Dive: ‡∏ó‡∏≥‡πÑ‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å E5-Large?

‡πÇ‡∏°‡πÄ‡∏î‡∏• Embedding ‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äî ‡πÄ‡∏ä‡πà‡∏ô `all-MiniLM-L6` (‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏ï‡πà‡πÄ‡∏•‡πá‡∏Å), `BGE-M3` (‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏Å), `E5-Large` (‡∏™‡∏°‡∏î‡∏∏‡∏•)

‡πÄ‡∏£‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å **E5-Large** ‡πÄ‡∏û‡∏£‡∏≤‡∏∞:

| ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢ | E5-Large | MiniLM-L6 | BGE-M3 |
|--------|----------|-----------|--------|
| **‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢** | ‚úÖ ‡∏î‡∏µ‡∏°‡∏≤‡∏Å | ‚ùå ‡∏≠‡πà‡∏≠‡∏ô | ‚úÖ ‡∏î‡∏µ‡∏°‡∏≤‡∏Å |
| **VRAM** | 2.2 GB | 0.3 GB | 4+ GB |
| **Dimension** | 1,024 | 384 | 1,024 |
| **‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| **‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö RTX 4060** | ‚úÖ ‡∏û‡∏≠‡∏î‡∏µ | ‚úÖ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏¢‡∏≠‡∏∞ | ‚ö†Ô∏è ‡πÅ‡∏ô‡πà‡∏ô‡∏°‡∏≤‡∏Å |

**‡∏™‡∏£‡∏∏‡∏õ:** E5-Large ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÅ‡∏•‡∏∞ VRAM

### üéì Deep Dive: Contrastive Learning ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

E5 ‡∏ñ‡∏π‡∏Å‡∏ù‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢ **Contrastive Learning** ‚Äî ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏µ‡πà‡∏ä‡∏≤‡∏ç‡∏â‡∏•‡∏≤‡∏î:

```
‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£:
- ‡πÉ‡∏´‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏î‡∏π‡∏Ñ‡∏π‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ô" (positive pair)
- ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏π‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß" (negative pair)
- ‡∏™‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏• ‡∏î‡∏±‡∏ô positive ‡πÉ‡∏´‡πâ‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ô ‡πÅ‡∏•‡∏∞ ‡∏ú‡∏•‡∏±‡∏Å negative ‡πÉ‡∏´‡πâ‡πÑ‡∏Å‡∏•‡∏Å‡∏±‡∏ô

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (‡∏Ç‡∏ì‡∏∞‡∏ù‡∏∂‡∏Å):
‚úÖ Positive: ("‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢", "‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°") ‚Üí ‡∏î‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏≤‡∏Å‡∏±‡∏ô
‚ùå Negative: ("‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢", "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥")     ‚Üí ‡∏ú‡∏•‡∏±‡∏Å‡∏≠‡∏≠‡∏Å

‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
- ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢" ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Ñ‡πà "‡∏Ñ‡∏≥"
- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô ‚Üí vector ‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ô!
```

> üí° **‡∏ó‡∏≥‡πÑ‡∏°‡∏ñ‡∏∂‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç?** ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏µ‡πà‡∏ù‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢ MLM (‡πÄ‡∏ä‡πà‡∏ô BERT ‡∏î‡∏¥‡∏ö) ‡πÅ‡∏ó‡∏ô Contrastive Learning ‡∏à‡∏∞‡πÑ‡∏î‡πâ embedding ‡∏ó‡∏µ‡πà "‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ô‡∏´‡∏°‡∏î" ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏¢‡∏Å‡πÅ‡∏¢‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏î‡∏µ ‚Äî ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ BERT ‡∏î‡∏¥‡∏ö‡∏ó‡∏≥ Semantic Search

### E5 Prefix Convention

‡πÇ‡∏°‡πÄ‡∏î‡∏• E5 ‡πÉ‡∏ä‡πâ prefix ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô "‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°":

```python
# ‡∏ï‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á index (‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£)
"passage: [Atomic Habits]\n‡∏Å‡∏é‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1..."

# ‡∏ï‡∏≠‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°)
"query: ‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏µ"
```

‡∏™‡∏¥‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ model ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à "‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó" ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‚Üí ‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô 10-15%

> üéì **‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á:** prefix ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á "Instruction-tuned Embedding" ‚Äî ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ñ‡∏π‡∏Å‡∏ù‡∏∂‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ß‡πà‡∏≤ `query:` ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á "‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö" ‡πÅ‡∏•‡∏∞ `passage:` ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á "‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö" ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ vector space ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏±‡∏ß‡πÑ‡∏î‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô retrieval ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô

### ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ Encoding

```
5,738 chunks
    ‚îÇ
    ‚ñº  Batch encoding (batch_size=32)
    ‚îÇ
    ‚îú‚îÄ‚îÄ Batch 1: chunks[0:32]    ‚Üí embeddings[0:32]
    ‚îú‚îÄ‚îÄ Batch 2: chunks[32:64]   ‚Üí embeddings[32:64]
    ‚îú‚îÄ‚îÄ ...
    ‚îî‚îÄ‚îÄ Batch 180: chunks[5728:5738] ‚Üí embeddings[5728:5738]
    ‚îÇ
    ‚ñº
Matrix: (5,738 √ó 1,024) float32
= ~23.5 MB ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• vector
```

**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á:** `rag_creator.py` ‚Üí `build_and_save()` ‡πÉ‡∏ä‡πâ `model.encode()`

---

## 5. FAISS Index ‚Äî ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Vector

### FAISS ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**FAISS (Facebook AI Similarity Search)** ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ‡∏à‡∏≤‡∏Å Meta AI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ vector ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å

> üéì **Nearest Neighbor Search:** ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á vector search ‡∏Ñ‡∏∑‡∏≠ "‡∏´‡∏≤ vector ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î" ‡∏à‡∏≤‡∏Å‡∏´‡∏°‡∏∑‡πà‡∏ô/‡∏•‡πâ‡∏≤‡∏ô vectors ‚Äî ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß (brute-force) ‡∏à‡∏∞‡∏ä‡πâ‡∏≤‡∏°‡∏≤‡∏Å ‡πÅ‡∏ï‡πà FAISS ‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏à‡∏≤‡∏Å computer science ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß ‡πÄ‡∏ä‡πà‡∏ô GPU parallelism, quantization, ‡πÅ‡∏•‡∏∞ index clustering

### ‡∏ä‡∏ô‡∏¥‡∏î Index ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: `IndexFlatIP`

```
IndexFlatIP = Inner Product (Cosine Similarity ‡πÄ‡∏°‡∏∑‡πà‡∏≠ normalize ‡πÅ‡∏•‡πâ‡∏ß)
```

| ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥ | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
|-----------|-----------|
| Algorithm | Brute-force (‡∏Ñ‡πâ‡∏ô‡∏ó‡∏∏‡∏Å vector) |
| Accuracy | 100% (exact search) |
| Speed | ‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å‡∏î‡πâ‡∏ß‡∏¢ GPU |
| ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö | Dataset < 1 ‡∏•‡πâ‡∏≤‡∏ô vectors |

### üéì Deep Dive: Inner Product vs L2 Distance

‡∏°‡∏µ 2 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á" ‡∏Ç‡∏≠‡∏á vector:

```
Inner Product (IP):  ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì dot product ‡∏Ç‡∏≠‡∏á 2 vectors
  ‚Üí ‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á = ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ô
  ‚Üí ‡πÄ‡∏°‡∏∑‡πà‡∏≠ normalize ‡πÅ‡∏•‡πâ‡∏ß = ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤ Cosine Similarity

L2 Distance (Euclidean): ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì "‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á" ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 2 ‡∏à‡∏∏‡∏î
  ‚Üí ‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≥ = ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ô
  ‚Üí ‡∏ñ‡πâ‡∏≤ normalize ‡πÅ‡∏•‡πâ‡∏ß ‡∏ú‡∏•‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô IP ‡∏ó‡∏∏‡∏Å‡∏Å‡∏£‡∏ì‡∏µ
```

**‡∏ó‡∏≥‡πÑ‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Inner Product?**
- E5 model ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö cosine similarity
- ‡πÄ‡∏£‡∏≤‡∏ó‡∏≥ L2-normalize ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏™‡πà FAISS ‚Üí IP = cosine similarity ‡∏ó‡∏∏‡∏Å‡∏Å‡∏£‡∏ì‡∏µ
- Inner Product **‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤** L2 ‡∏ö‡∏ô GPU ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÉ‡∏ä‡πâ matrix multiplication ‡∏ã‡∏∂‡πà‡∏á GPU ‡∏ñ‡∏ô‡∏±‡∏î‡∏°‡∏≤‡∏Å

### üéì Deep Dive: ‡∏ó‡∏≥‡πÑ‡∏° GPU ‡∏ñ‡∏∂‡∏á‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ CPU?

```
CPU: ‡πÄ‡∏Å‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô ‡πÅ‡∏ï‡πà‡∏ó‡∏≥‡∏ó‡∏µ‡∏•‡∏∞‡∏ô‡πâ‡∏≠‡∏¢ (8-16 cores)
     ‚Üí ‡∏Ñ‡πâ‡∏ô 5,738 vectors ‚âà 10-50ms

GPU: ‡πÄ‡∏Å‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡πÅ‡∏ï‡πà‡∏ó‡∏≥‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏±‡∏ô (4,096+ cores)
     ‚Üí ‡∏Ñ‡πâ‡∏ô 5,738 vectors ‚âà 1-5ms

Vector search = "‡∏Ñ‡∏π‡∏ì matrix + ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö" ‚Üí GPU ‡∏ñ‡∏ô‡∏±‡∏î‡∏°‡∏≤‡∏Å!
```

> ‚ö° **‡∏ú‡∏•‡∏à‡∏£‡∏¥‡∏á:** ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏≤ GPU ‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ CPU **5-10 ‡πÄ‡∏ó‡πà‡∏≤** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 5,738 vectors

### ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤

```
Query vector (1 √ó 1,024)
    ‚îÇ
    ‚ñº  Inner Product ‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å vector ‡πÉ‡∏ô index
    ‚îÇ
Index vectors (5,738 √ó 1,024)
    ‚îÇ
    ‚ñº  Sort by score
    ‚îÇ
Top-10 results (indices + scores)
```

**‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡πâ‡∏ô:** ~1-5 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (GPU) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 5,738 vectors

### ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å

```
storage/
‚îú‚îÄ‚îÄ RAG_system.faiss        # FAISS index (vector data)
‚îú‚îÄ‚îÄ RAG_system_data.pkl     # ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° chunk ‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö (5,738 entries)
‚îî‚îÄ‚îÄ RAG_system_bm25.pkl     # Tokenized corpus ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö BM25
```

---

## 6. BM25 ‚Äî Keyword Search

### BM25 ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**BM25 (Best Matching 25)** ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏•‡∏Å‡∏≠‡∏£‡∏¥‡∏ó‡∏∂‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö keyword ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πâ‡∏ô‡∏õ‡∏µ 1994 ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÇ‡∏•‡∏Å)

### ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

BM25 ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ï‡∏≤‡∏° 3 ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢:

```
Score = TF √ó IDF √ó Length_Normalization
```

| ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ | ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á |
|--------|---------|---------|
| **TF** (Term Frequency) | ‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Å‡∏µ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á | "‡∏ô‡∏¥‡∏™‡∏±‡∏¢" ‡∏õ‡∏£‡∏≤‡∏Å‡∏è 5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‚Üí ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á |
| **IDF** (Inverse Document Frequency) | ‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡∏´‡∏≤‡∏¢‡∏≤‡∏Å‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ | "Atomic Habits" ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏Ñ‡πà‡πÑ‡∏°‡πà‡∏Å‡∏µ‡πà chunk ‚Üí ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á |
| **Length Norm** | ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ | ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏£‡∏á ‚Üí ‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏¢‡∏≤‡∏ß |

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á

```
Query: "Atomic Habits"

Chunk A: "[Atomic Habits] ‡∏Å‡∏é‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1..."
  ‚Üí TF: "Atomic" ‚úÖ "Habits" ‚úÖ
  ‚Üí IDF: ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "Atomic Habits" ‡∏´‡∏≤‡∏¢‡∏≤‡∏Å ‚Üí ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å!
  ‚Üí Score: 8.5

Chunk B: "[‡∏™‡∏≤‡∏°‡∏Å‡πä‡∏Å] ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°..."
  ‚Üí TF: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢
  ‚Üí Score: 0.0
```

### Tokenization ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢

‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏≥ ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ **regex-based tokenizer**:

```python
def tokenize_thai(text):
    # ‡∏à‡∏±‡∏ö‡∏Ñ‡∏≥‡πÑ‡∏ó‡∏¢ + ‡∏Ñ‡∏≥‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©/‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
    tokens = re.findall(r'[\u0E00-\u0E7F]+|[a-zA-Z0-9]+', text.lower())
    # ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏±‡πâ‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô (1 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)
    return [t for t in tokens if len(t) > 1]
```

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
```
Input:  "[Atomic Habits] ‡∏Å‡∏é‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô"
Tokens: ["atomic", "habits", "‡∏Å‡∏é‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà", "‡∏ó‡∏≥‡πÉ‡∏´‡πâ", "‡∏°‡∏±‡∏ô", "‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô"]
```

> üìù **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** tokenizer ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ä‡πâ regex ‡∏ã‡∏∂‡πà‡∏á "‡∏î‡∏µ‡∏û‡∏≠" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö BM25
> ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô `PyThaiNLP` ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï

**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á:** `rag_creator.py` ‚Üí `tokenize_thai()`, `rag_searcher.py` ‚Üí `_bm25_search()`

---

## 7. Hybrid Search ‚Äî ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏ú‡∏™‡∏°

### ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á Hybrid?

| ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå | Dense Search | BM25 | Hybrid |
|-----------|-------------|------|--------|
| "‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢" | ‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ | ‚ö†Ô∏è ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏£‡∏á | ‚úÖ |
| "Atomic Habits" | ‚ö†Ô∏è ‡∏≠‡∏≤‡∏à‡πÄ‡∏à‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏∑‡πà‡∏ô | ‚úÖ ‡∏à‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏á | ‚úÖ |
| "Jensen Huang ‡∏û‡∏π‡∏î‡∏≠‡∏∞‡πÑ‡∏£" | ‚ö†Ô∏è | ‚úÖ ‡∏à‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô | ‚úÖ |
| "‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô" | ‚úÖ ‡∏à‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏° | ‚ùå | ‚úÖ |

**Hybrid = ‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡πÇ‡∏•‡∏Å**

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô

```
Query: "Atomic Habits ‡∏™‡∏≠‡∏ô‡∏≠‡∏∞‡πÑ‡∏£"
                ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚ñº               ‚ñº
   Dense Search     BM25 Search
   (FAISS)          (rank-bm25)
        ‚îÇ               ‚îÇ
        ‚ñº               ‚ñº
   Raw Scores       Raw Scores
   [0.85, 0.72,    [8.5, 0.0,
    0.68, 0.45]     6.2, 3.1]
        ‚îÇ               ‚îÇ
        ‚ñº               ‚ñº
   Normalize 0-1    Normalize 0-1
   [1.0, 0.68,     [1.0, 0.0,
    0.58, 0.0]      0.73, 0.36]
        ‚îÇ               ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚ñº
        Weighted Merge
        Dense √ó 0.7 + BM25 √ó 0.3
        ‚îÇ
        ‚ñº
   [1.0√ó0.7 + 1.0√ó0.3 = 1.00,    ‚Üê Chunk A (‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà‡πÄ‡∏´‡πá‡∏ô‡∏î‡πâ‡∏ß‡∏¢!)
    0.68√ó0.7 + 0.0√ó0.3 = 0.48,
    0.58√ó0.7 + 0.73√ó0.3 = 0.63,  ‚Üê Chunk C (BM25 ‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏±‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô!)
    0.0√ó0.7 + 0.36√ó0.3 = 0.11]
```

### Weight ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ

| Weight | ‡∏Ñ‡πà‡∏≤ | ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• |
|--------|-----|--------|
| `HYBRID_DENSE_WEIGHT` | **0.7** | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‚Üí ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏£‡∏á |
| `HYBRID_BM25_WEIGHT` | **0.3** | ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÑ‡∏ß‡πâ‡∏à‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞ |

> üí° **Tuning Tip:** ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏¢‡∏≠‡∏∞ (‡πÄ‡∏ä‡πà‡∏ô FAQ, glossary) ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏° BM25 ‡πÄ‡∏õ‡πá‡∏ô 0.4-0.5

### Score Normalization

‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏ß‡∏° Dense + BM25 ‡∏ï‡πâ‡∏≠‡∏á **normalize** ‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏û‡∏£‡∏≤‡∏∞:
- Dense scores: ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 0‚Äì1 (cosine similarity)
- BM25 scores: ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 0‚Äì‚àû (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï)

**‡∏ß‡∏¥‡∏ò‡∏µ: Min-Max Normalization**
```
normalized = (score - min) / (max - min)
```

‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 0‚Äì1 ‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏î‡πâ‡∏ß‡∏¢ weight

**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á:** `rag_searcher.py` ‚Üí `_hybrid_merge()`, `_normalize_scores()`

**‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á:** `config.py` ‚Üí `HYBRID_DENSE_WEIGHT`, `HYBRID_BM25_WEIGHT`

---

## 8. Reranker + Adaptive Reranking ‚Äî ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ã‡πâ‡∏≥‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞

### ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á Rerank?

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏≠‡∏á Stage 1 (Retrieval):**
- Dense Search ‡πÉ‡∏ä‡πâ **Bi-Encoder** ‚Äî encode query ‡∏Å‡∏±‡∏ö document ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô ‚Üí ‡πÄ‡∏£‡πá‡∏ß ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÅ‡∏°‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
- BM25 ‡∏ô‡∏±‡∏ö‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏≥ ‚Üí ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ö‡∏£‡∏¥‡∏ö‡∏ó

**Reranker ‡πÉ‡∏ä‡πâ Cross-Encoder** ‚Äî ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏π‡πà (query, document) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô:

```
Bi-Encoder (Stage 1):              Cross-Encoder (Stage 2):

 Query ‚Üí [Encoder] ‚Üí vec_q          Query ‚îÄ‚îÄ‚îê
                      ‚Üï similarity           ‚îú‚Üí [Encoder] ‚Üí Score
 Doc   ‚Üí [Encoder] ‚Üí vec_d          Doc   ‚îÄ‚îÄ‚îò

 ‡πÄ‡∏£‡πá‡∏ß ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÅ‡∏°‡πà‡∏ô 100%              ‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤ ‡πÅ‡∏ï‡πà‡πÅ‡∏°‡πà‡∏ô‡∏°‡∏≤‡∏Å!
```

### ‡∏ó‡∏≥‡πÑ‡∏° Cross-Encoder ‡πÅ‡∏°‡πà‡∏ô‡∏Å‡∏ß‡πà‡∏≤?

‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏±‡∏ô "‡∏≠‡πà‡∏≤‡∏ô" query ‡πÅ‡∏•‡∏∞ document **‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô** ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à:
- ‡∏Ñ‡∏≥‡πÑ‡∏´‡∏ô‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ "‡∏ï‡∏≠‡∏ö" ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
- ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏£‡∏≠‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥
- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Å‡∏±‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤

### ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: `BAAI/bge-reranker-v2-m3`

| ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥ | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
|-----------|-----------|
| Architecture | XLM-RoBERTa (Cross-Encoder) |
| Parameters | ~568 ‡∏•‡πâ‡∏≤‡∏ô |
| ‡∏†‡∏≤‡∏©‡∏≤ | 100+ ‡∏†‡∏≤‡∏©‡∏≤ (‡∏£‡∏ß‡∏°‡πÑ‡∏ó‡∏¢) |
| Version | v2-m3 (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î, multilingual) |
| ‡∏Ç‡∏ô‡∏≤‡∏î | ~2.2 GB |

### ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ Reranking

```
‡∏à‡∏≤‡∏Å Hybrid Merge: 10 candidates
    ‚îÇ
    ‚ñº  ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏π‡πà (query, doc) ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏π‡πà
    ‚îÇ
    ‚îú‚îÄ‚îÄ (query, chunk_A) ‚Üí Score: 0.92
    ‚îú‚îÄ‚îÄ (query, chunk_C) ‚Üí Score: 0.87
    ‚îú‚îÄ‚îÄ (query, chunk_B) ‚Üí Score: 0.45
    ‚îú‚îÄ‚îÄ ...
    ‚îÇ
    ‚ñº  Sort by score (descending)
    ‚îÇ
    Top-5 Final Results
```

### Adaptive Reranking ‚Äî ‡∏Ç‡πâ‡∏≤‡∏° Reranker ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô

‡∏£‡∏∞‡∏ö‡∏ö production ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÇ‡∏•‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ rerank ‡∏ó‡∏∏‡∏Å query ‚Äî ‡∏°‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤ "‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏´‡∏°?"

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£:** ‡∏ñ‡πâ‡∏≤ Hybrid Search ‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà **Top-1 ‡∏ó‡∏¥‡πâ‡∏á‡∏´‡πà‡∏≤‡∏á Top-2 ‡∏°‡∏≤‡∏Å** (score gap ‡∏™‡∏π‡∏á) ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡∏Ç‡πâ‡∏≤‡∏° Reranker ‡πÑ‡∏î‡πâ

```
Hybrid Merge Scores
        ‚îÇ
        ‚ñº
   Gap = Top-1 - Top-2
        ‚îÇ
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚ñº         ‚ñº
 Gap > 0.15  Gap ‚â§ 0.15
 (‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô)    (‡∏Å‡∏≥‡∏Å‡∏ß‡∏°)
   ‚îÇ         ‚îÇ
   ‚ñº         ‚ñº
 ‚ö° Skip     üî¨ Rerank
 ~15ms      ~300ms
```

### ‡∏ú‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏à‡∏£‡∏¥‡∏á (Benchmark)

| Query | Gap | Mode | ‡πÄ‡∏ß‡∏•‡∏≤ | ‡∏ó‡∏≥‡πÑ‡∏°? |
|-------|-----|------|------|-------|
| "Atomic Habits ‡∏™‡∏≠‡∏ô‡∏≠‡∏∞‡πÑ‡∏£..." | 0.032 | üî¨ Rerank | 0.576s | ‡∏´‡∏•‡∏≤‡∏¢ chunk ‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÅ‡∏Ç‡πà‡∏á‡∏Å‡∏±‡∏ô |
| "Rich Dad Poor Dad..." | 0.248 | ‚ö° Skip | **0.020s** | ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‚Üí ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏î‡πâ |
| "‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏à‡∏£‡∏à‡∏≤‡∏ï‡πà‡∏≠‡∏£‡∏≠‡∏á" | 0.428 | ‚ö° Skip | **0.015s** | Top-1 ‡∏ó‡∏¥‡πâ‡∏á‡∏´‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏Å |
| "‡∏ß‡∏¥‡∏ò‡∏µ‡∏ù‡∏∂‡∏Å‡∏™‡∏°‡∏≤‡∏ò‡∏¥..." | 0.092 | üî¨ Rerank | 0.190s | ‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏û‡∏≠‡πÜ ‡∏Å‡∏±‡∏ô |
| "‡∏ã‡∏∏‡∏ô‡∏ß‡∏π‡∏™‡∏≠‡∏ô‡∏≠‡∏∞‡πÑ‡∏£..." | 0.175 | ‚ö° Skip | **0.015s** | ‡∏ã‡∏∏‡∏ô‡∏ß‡∏π‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô |

**‡∏ú‡∏•‡∏™‡∏£‡∏∏‡∏õ:** 3 ‡πÉ‡∏ô 5 queries ‡∏Ç‡πâ‡∏≤‡∏° Reranker ‡πÑ‡∏î‡πâ = ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î GPU ~60% ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥

> üí° **Tuning Tip:**
> - `RERANK_SCORE_GAP = 0.10` ‚Üí rerank ‡∏ö‡πà‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô (‡πÅ‡∏°‡πà‡∏ô‡∏Å‡∏ß‡πà‡∏≤ ‡πÅ‡∏ï‡πà‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤)
> - `RERANK_SCORE_GAP = 0.20` ‚Üí skip ‡∏ö‡πà‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô (‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ ‡πÅ‡∏ï‡πà‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏ß‡πà‡∏≤)
> - `RERANK_SCORE_GAP = 0.00` ‚Üí rerank ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏õ‡∏¥‡∏î Adaptive)

**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á:** `rag_searcher.py` ‚Üí `_should_rerank()`, `search()`

**‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á:** `config.py` ‚Üí `RERANK_SCORE_GAP = 0.15`

---

## 9. Search Pipeline ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°

### End-to-End Flow

```
User: "Atomic Habits ‡∏™‡∏≠‡∏ô‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£"
‚îÇ
‚ñº Stage 1a: Dense Search (GPU)
‚îÇ  query ‚Üí e5-large ‚Üí query_vector
‚îÇ  query_vector √ó FAISS index ‚Üí Top 10 (by cosine similarity)
‚îÇ  ‚è±Ô∏è ~5ms
‚îÇ
‚ñº Stage 1b: BM25 Search (CPU)
‚îÇ  query ‚Üí tokenize ‚Üí ["atomic", "habits", "‡∏™‡∏≠‡∏ô", "‡∏ß‡∏¥‡∏ò‡∏µ", "‡∏™‡∏£‡πâ‡∏≤‡∏á", "‡∏ô‡∏¥‡∏™‡∏±‡∏¢"]
‚îÇ  BM25.get_scores(tokens) ‚Üí Top 10 (by TF-IDF)
‚îÇ  ‚è±Ô∏è ~1ms
‚îÇ
‚ñº Stage 2: Score Merge
‚îÇ  Dense scores: normalize to 0-1, weight √ó 0.7
‚îÇ  BM25 scores:  normalize to 0-1, weight √ó 0.3
‚îÇ  merged = dense + bm25 ‚Üí Top 10 unique candidates
‚îÇ  ‚è±Ô∏è ~0.1ms
‚îÇ
‚ñº Stage 3: Adaptive Reranking Decision
‚îÇ  gap = Top-1 score - Top-2 score
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚îÇ gap > 0.15 ‚Üí ‚ö° Skip!   ‚îÇ  ‚Üê Fast mode (~15ms total)
‚îÇ  ‚îÇ gap ‚â§ 0.15 ‚Üí üî¨ Rerank ‚îÇ  ‚Üê Precision mode (~300ms)
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ  If Reranking: 10 pairs ‚Üí bge-reranker-v2-m3.predict()
‚îÇ  ‚è±Ô∏è ~0ms (skip) or ~300ms (rerank)
‚îÇ
‚ñº Output
‚îÇ  [1] (Score: 0.99) [Atomic Habits] ‡∏™‡∏£‡∏∏‡∏õ: ‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á...
‚îÇ  [2] (Score: 0.98) [Atomic Habits] ‡πÄ‡∏Å‡∏£‡∏¥‡πà‡∏ô‡∏ô‡∏≥: ‡∏û‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏≠‡∏∞‡∏ï‡∏≠‡∏°...
‚îÇ  ...
‚îÇ
‚è±Ô∏è Total: ~15ms (clear) or ~300-500ms (ambiguous)
```

---

## 10. ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà

```
RAG/
‚îÇ
‚îú‚îÄ‚îÄ config.py              ‚öôÔ∏è Central Configuration
‚îÇ   ‚îî‚îÄ‚îÄ ‡∏ó‡∏∏‡∏Å setting ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà: paths, models, chunking, hybrid weights
‚îÇ
‚îú‚îÄ‚îÄ rag_creator.py         üî® Index Builder (Core)
‚îÇ   ‚îú‚îÄ‚îÄ TextChunker        ‚Üí ‡πÅ‡∏ö‡πà‡∏á chunk + overlap
‚îÇ   ‚îú‚îÄ‚îÄ tokenize_thai()    ‚Üí tokenize ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö BM25
‚îÇ   ‚îî‚îÄ‚îÄ RAGCreator         ‚Üí ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚Üí chunk ‚Üí embed ‚Üí save
‚îÇ
‚îú‚îÄ‚îÄ rag_searcher.py        üîç Search Engine (Core)
‚îÇ   ‚îú‚îÄ‚îÄ tokenize_thai()    ‚Üí tokenize query ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö BM25
‚îÇ   ‚îî‚îÄ‚îÄ RAGSearcher        ‚Üí Dense + BM25 ‚Üí merge ‚Üí adaptive rerank
‚îÇ       ‚îú‚îÄ‚îÄ _dense_search()
‚îÇ       ‚îú‚îÄ‚îÄ _bm25_search()
‚îÇ       ‚îú‚îÄ‚îÄ _normalize_scores()
‚îÇ       ‚îú‚îÄ‚îÄ _hybrid_merge()
‚îÇ       ‚îú‚îÄ‚îÄ _should_rerank()  ‚Üí ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à rerank ‡∏´‡∏£‡∏∑‡∏≠ skip
‚îÇ       ‚îî‚îÄ‚îÄ search()       ‚Üí orchestrate ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
‚îÇ
‚îú‚îÄ‚îÄ build_index.py         ‚ñ∂Ô∏è Entry Point: ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà index
‚îú‚îÄ‚îÄ search.py              ‚ñ∂Ô∏è Entry Point: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ interactive
‚îú‚îÄ‚îÄ test_rag.py            ‚ñ∂Ô∏è Entry Point: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
‚îÇ
‚îú‚îÄ‚îÄ data/                  üìÇ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á (.jsonl)
‚îú‚îÄ‚îÄ storage/               üíæ Index + Data ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß
‚îÇ   ‚îú‚îÄ‚îÄ RAG_system.faiss       ‚Üí FAISS vector index
‚îÇ   ‚îú‚îÄ‚îÄ RAG_system_data.pkl    ‚Üí ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° chunk ‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö
‚îÇ   ‚îî‚îÄ‚îÄ RAG_system_bm25.pkl   ‚Üí Tokenized corpus ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö BM25
‚îÇ
‚îî‚îÄ‚îÄ docs/                  üìñ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
    ‚îî‚îÄ‚îÄ technical_guide.md     ‚Üí ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ
```

### ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå

```
config.py ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ rag_creator.py
    ‚ñ≤                    ‚ñ≤
    ‚îÇ                    ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ rag_searcher.py
    ‚îÇ                    ‚ñ≤
    ‚îÇ                    ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ build_index.py ‚îò (‡πÉ‡∏ä‡πâ RAGCreator)
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ search.py ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ (‡πÉ‡∏ä‡πâ RAGSearcher)
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ test_rag.py ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ (‡πÉ‡∏ä‡πâ RAGSearcher)
```

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö:**
- **Separation of Concerns:** ‡πÅ‡∏¢‡∏Å Creator (‡∏™‡∏£‡πâ‡∏≤‡∏á) ‡∏Å‡∏±‡∏ö Searcher (‡∏Ñ‡πâ‡∏ô) ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
- **Single Source of Truth:** config.py ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö settings
- **Entry Points ‡πÅ‡∏¢‡∏Å:** ‡πÅ‡∏ï‡πà‡∏•‡∏∞ script ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (SRP)

---

## 11. Configuration ‚Äî ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤

‡∏ó‡∏∏‡∏Å setting ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô `config.py` ‚Äî ‡πÅ‡∏Å‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏°‡∏µ‡∏ú‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö:

```python
# === Paths ===
BASE_DIR     = "/home/mikedev/RAG"
DATA_DIR     = "/home/mikedev/RAG/data"
STORAGE_DIR  = "/home/mikedev/RAG/storage"

# === Models ===
MODEL_EMBEDDING = ".../intfloat-multilingual-e5-large"   # Bi-Encoder
MODEL_RERANKER  = ".../BAAI-bge-reranker-v2-m3"          # Cross-Encoder

# === Index ===
INDEX_NAME = "RAG_system"

# === Chunking ===
CHUNK_SIZE    = 500    # ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ï‡πà‡∏≠ chunk
CHUNK_OVERLAP = 100    # ‡∏™‡πà‡∏ß‡∏ô‡∏ã‡πâ‡∏≥‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á chunk

# === Hybrid Search ===
HYBRID_DENSE_WEIGHT = 0.7    # ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å Dense (semantic)
HYBRID_BM25_WEIGHT  = 0.3    # ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å BM25 (keyword)

# === Adaptive Reranking ===
RERANK_SCORE_GAP = 0.15      # Gap threshold (0.0=always rerank, 1.0=never)

# === Search ===
TOP_K_RETRIEVAL = 10   # ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô candidates ‡∏à‡∏≤‡∏Å Stage 1
TOP_K_DISPLAY   = 5    # ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ (‡∏´‡∏•‡∏±‡∏á Rerank)
BATCH_SIZE      = 32   # Batch size ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö embedding
```

### ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤

| Parameter | ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠ | ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ |
|-----------|----------|---------|
| `CHUNK_SIZE` | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏¢‡∏≠‡∏∞ | ‡∏•‡∏î‡πÄ‡∏õ‡πá‡∏ô 300 |
| `CHUNK_SIZE` | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô 800 |
| `CHUNK_OVERLAP` | ‡∏Ñ‡πâ‡∏ô‡πÄ‡∏à‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• "‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÜ ‡∏Å‡∏•‡∏≤‡∏á‡πÜ" | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô 150 |
| `HYBRID_BM25_WEIGHT` | ‡∏Ñ‡πâ‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏à‡∏≠ | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô 0.4 |
| `RERANK_SCORE_GAP` | ‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ rerank ‡∏ö‡πà‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô | ‡∏•‡∏î‡πÄ‡∏õ‡πá‡∏ô 0.10 |
| `RERANK_SCORE_GAP` | ‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ skip ‡∏ö‡πà‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô 0.20 |
| `TOP_K_RETRIEVAL` | ‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ Reranker ‡∏°‡∏µ pool ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô 20 |
| `BATCH_SIZE` | VRAM ‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏ï‡∏≠‡∏ô build | ‡∏•‡∏î‡πÄ‡∏õ‡πá‡∏ô 16 |

---

## 12. ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (VRAM/RAM)

### VRAM Budget (RTX 4060 ‚Äî 8 GB)

| Component | VRAM | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ |
|-----------|------|---------|
| e5-large | ~2.2 GB | GPU (Embedding) |
| bge-reranker-v2-m3 | ~2.2 GB | GPU (Reranking) |
| FAISS Index | ~0.01 GB | GPU (Vector Search) |
| CUDA overhead | ~0.8 GB | GPU (Base) |
| **BM25** | **0 GB** | **CPU only!** |
| **‡∏£‡∏ß‡∏°** | **~5.2 GB** | ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ~2.8 GB |

### RAM Usage

| Component | RAM |
|-----------|-----|
| BM25 index | ~50 MB |
| Text data (pkl) | ~5 MB |
| Python + libs | ~500 MB |
| **‡∏£‡∏ß‡∏°** | **~555 MB** |

### Storage

| File | ‡∏Ç‡∏ô‡∏≤‡∏î |
|------|------|
| RAG_system.faiss | ~23.5 MB |
| RAG_system_data.pkl | ~5.3 MB |
| RAG_system_bm25.pkl | ~1 MB |
| **‡∏£‡∏ß‡∏°** | **~30 MB** |

---

## 13. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏°‡πÄ‡∏î‡∏• AI

### Embedding: intfloat/multilingual-e5-large

- **‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤:** Microsoft Research
- **‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°:** XLM-RoBERTa Large
- **‡∏ß‡∏¥‡∏ò‡∏µ‡∏ù‡∏∂‡∏Å:** Contrastive learning ‡∏ö‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏≤‡∏¢‡∏†‡∏≤‡∏©‡∏≤
- **‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô:** ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏†‡∏≤‡∏©‡∏≤ ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ cross-lingual retrieval
- **Prefix:** ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà `"passage: "` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞ `"query: "` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
- **‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö:** `/home/mikedev/MyModels/Model-RAG/intfloat-multilingual-e5-large`

### Reranker: BAAI/bge-reranker-v2-m3

- **‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤:** Beijing Academy of AI (BAAI)
- **‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°:** XLM-RoBERTa (Cross-Encoder)
- **Version:** v2-m3 (Multi-lingual, Multi-granularity, Multi-function)
- **‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô:** ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠ multilingual reranking ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞
- **‡∏ä‡∏ô‡∏¥‡∏î output:** Single float score (‡∏¢‡∏¥‡πà‡∏á‡∏™‡∏π‡∏á ‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á)
- **‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö:** `/home/mikedev/MyModels/Model-RAG/BAAI-bge-reranker-v2-m3`

---

## 14. Flow Chart ‚Äî ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô

### A. Index Building (‡∏ó‡∏≥‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)

```
data/*.jsonl
    ‚îÇ
    ‚ñº  ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå + parse JSON
    ‚îÇ
Raw Documents (3,002 entries)
    ‚îÇ
    ‚ñº  TextChunker (500 chars, overlap 100)
    ‚îÇ
Chunked Documents (5,738 chunks)
    ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚ñº                  ‚ñº
e5-large Encode     tokenize_thai()
    ‚îÇ                  ‚îÇ
    ‚ñº                  ‚ñº
FAISS Index         BM25 Corpus
(5,738 vectors)     (5,738 token lists)
    ‚îÇ                  ‚îÇ
    ‚ñº                  ‚ñº
.faiss file         _bm25.pkl file
    ‚îÇ
    ‚ñº
_data.pkl file (original text)
```

### B. Full RAG Pipeline (‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏≤‡∏°)

```
User Query
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Stage 0: HyDE Transform ‚îÇ
‚îÇ  (Groq LLaMA 3.3 70B)   ‚îÇ
‚îÇ  ~1.5s                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚ñº                 ‚ñº
Dense Search       BM25 Search
(FAISS + GPU)      (CPU)
~5ms               ~1ms
    ‚îÇ                 ‚îÇ
    ‚ñº                 ‚ñº
Normalize 0-1      Normalize 0-1
    ‚îÇ                 ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚ñº
    Weighted Merge (0.7 + 0.3)
              ‚îÇ
              ‚ñº
    Top-10 Candidates
              ‚îÇ
              ‚ñº
    Adaptive Reranking Decision
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ gap > 0.15 ‚Üí ‚ö° Skip!   ‚îÇ
    ‚îÇ gap ‚â§ 0.15 ‚Üí üî¨ Rerank ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
              ‚ñº
    Top-5 Final Results
              ‚îÇ
              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Stage 3: LLM Generation ‚îÇ
‚îÇ  (Gemini 2.5 Flash)      ‚îÇ
‚îÇ  SSE Streaming ‚Üí Web UI  ‚îÇ
‚îÇ  ~5-8s                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
              ‚ñº
    üéØ Answer + Sources
    ‚è±Ô∏è Total: ~7-10s (with HyDE + Gen)
```

---

## 10. HyDE ‚Äî Query Transform

### HyDE ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**HyDE (Hypothetical Document Embedding)** ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ LLM ‡∏™‡∏£‡πâ‡∏≤‡∏á "‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏°‡∏°‡∏ï‡∏¥" ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°

> üéì **‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏ó‡∏≤‡∏á‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£:** HyDE ‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏Ç‡∏≠‡∏á Gao et al. (2023) ‡∏à‡∏≤‡∏Å Carnegie Mellon University ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ *"Precise Zero-Shot Dense Retrieval without Relevance Labels"* ‚Äî ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏Ñ‡∏∑‡∏≠ LLM ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÅ‡∏ï‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ "‡∏à‡∏¥‡∏ô‡∏ï‡∏ô‡∏≤‡∏Å‡∏≤‡∏£" ‡∏ß‡πà‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ embedding search ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô

### üéì Deep Dive: Vocabulary Mismatch Problem

‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà HyDE ‡πÅ‡∏Å‡πâ‡∏Ñ‡∏∑‡∏≠ **Vocabulary Mismatch** ‚Äî ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏Ñ‡∏ô‡∏•‡∏∞‡∏ä‡∏∏‡∏î:

```
‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ñ‡∏≤‡∏°:         "‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ä‡πâ‡∏≤"
‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô:   "‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö circadian rhythm ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ô‡∏≠‡∏ô"

Dense Search:      query vector vs doc vector ‚Üí ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡πà‡∏≥ (‡∏Ñ‡∏≥‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô)
BM25:              ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢ ‚Üí ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 0

HyDE ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏°‡∏°‡∏ï‡∏¥:
"‡∏Å‡∏≤‡∏£‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ä‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö circadian rhythm
‡∏Ç‡∏≠‡∏á‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢ ‡πÇ‡∏î‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠ ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏™‡∏á‡∏™‡∏µ‡∏ü‡πâ‡∏≤..."

‚Üí ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏à‡∏£‡∏¥‡∏á!
‚Üí Embedding ‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ô ‚Üí ‡∏Ñ‡πâ‡∏ô‡πÄ‡∏à‡∏≠!
```

> üí° **‡∏™‡∏£‡∏∏‡∏õ‡∏á‡πà‡∏≤‡∏¢‡πÜ:** HyDE ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô "‡∏ô‡∏±‡∏Å‡πÅ‡∏õ‡∏•" ‡∏ó‡∏µ‡πà‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ ‚Üí ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£

### ‡∏ó‡∏≥‡πÑ‡∏°‡πÉ‡∏ä‡πâ Groq ‡πÅ‡∏ó‡∏ô Gemini?

| ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢ | Groq (LLaMA 3.3 70B) | Gemini 2.5 Flash |
|--------|----------------------|------------------|
| **‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß** | ~1.5s (‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å) | ~3-5s |
| **‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢** | ‡∏ü‡∏£‡∏µ (tier) | ‡∏ü‡∏£‡∏µ (tier) |
| **‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà** | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏°‡∏°‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏°‡∏≤‡∏Å) | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ (‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏°‡πà‡∏ô) |
| **Rate Limit** | ‡πÅ‡∏¢‡∏Å pool (3 keys) | ‡πÅ‡∏¢‡∏Å pool (10 keys) |

**‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏Å:** ‡πÅ‡∏¢‡∏Å LLM ‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏ï‡∏±‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠:
1. **‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß:** Groq ‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ Gemini 2-3 ‡πÄ‡∏ó‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô HyDE
2. **Rate Limit:** ‡πÑ‡∏°‡πà‡πÅ‡∏¢‡πà‡∏á quota ‡∏Å‡∏±‡∏ö Gemini ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
3. **Separation of Concerns:** ‡πÅ‡∏ï‡πà‡∏•‡∏∞ LLM ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

### ‡πÑ‡∏ü‡∏•‡πå: `core/query_transformer.py`

| Component | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
|-----------|----------|
| LLM | Groq LLaMA 3.3 70B |
| Prompt | Concept-driven, ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ |
| Max Tokens | 512 |
| Temperature | 0.7 (‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢) |
| Fallback | ‡∏ñ‡πâ‡∏≤ API ‡∏•‡πà‡∏° ‚Üí ‡πÉ‡∏ä‡πâ query ‡πÄ‡∏î‡∏¥‡∏° |
| ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î | `config.ENABLE_HYDE = True/False` |

### Flow

```
"‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏µ"
    ‚îÇ
    ‚ñº (Groq LLaMA 3.3 70B)
    ‚îÇ
"‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Å‡∏•‡πÑ‡∏Å‡∏Ç‡∏≠‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢
‡∏ã‡∏∂‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ 4 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô: ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô (Cue),
‡πÅ‡∏£‡∏á‡∏õ‡∏£‡∏≤‡∏£‡∏ñ‡∏ô‡∏≤ (Craving), ‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á (Response),
‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (Reward)..."
    ‚îÇ
    ‚ñº (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡πÅ‡∏ó‡∏ô)
    ‚îÇ
Hybrid Search ‚Üí Adaptive Reranking ‚Üí Results
```

---

## 11. LLM Generation ‚Äî Gemini

### ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà

‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å Search + Reranking ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤

> üéì **Grounding ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?** ‡πÉ‡∏ô‡∏ö‡∏£‡∏¥‡∏ö‡∏ó AI, Grounding ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ LLM "‡∏¢‡∏∂‡∏î‡πÇ‡∏¢‡∏á" ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏≤‡∏à‡∏ú‡∏¥‡∏î/‡πÄ‡∏Å‡πà‡∏≤) ‡∏£‡∏∞‡∏ö‡∏ö RAG ‡∏ó‡∏≥ Grounding ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á context ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏´‡πâ Gemini ‡∏≠‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ö ‚Üí ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏∂‡∏á‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÑ‡∏î‡πâ ‡πÑ‡∏°‡πà‡∏´‡∏•‡∏≠‡∏ô

### ‡πÑ‡∏ü‡∏•‡πå: `core/llm_generator.py`

| Component | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
|-----------|----------|
| Model | Gemini 2.5 Flash |
| Temperature | 0.3 (‡∏ï‡∏≠‡∏ö‡∏ä‡∏±‡∏î ‡πÑ‡∏°‡πà‡πÄ‡∏û‡πâ‡∏≠) |
| Max Tokens | ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î (‡πÉ‡∏´‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÄ‡∏≠‡∏á) |
| System Prompt | Adaptive role ‚Äî ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó |
| Streaming | SSE (Server-Sent Events) real-time |
| Key Rotation | Round-robin 10 keys |

### üéì Deep Dive: Temperature ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

Temperature ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡πà‡∏°" ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏Ç‡∏≠‡∏á LLM:

```
Temperature = 0.0 ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÄ‡∏™‡∏°‡∏≠ (deterministic)
Temperature = 0.3 ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‚Üê ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ
Temperature = 0.7 ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå‡∏Ç‡∏∂‡πâ‡∏ô (HyDE ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ)
Temperature = 1.0 ‚Üí ‡∏™‡∏∏‡πà‡∏°‡∏°‡∏≤‡∏Å ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô
```

**‡∏ó‡∏≥‡πÑ‡∏°‡πÉ‡∏ä‡πâ 0.3?** ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏á‡∏≤‡∏ô RAG ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà **‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£** ‚Äî ‡∏ñ‡πâ‡∏≤‡∏™‡∏∏‡πà‡∏°‡∏°‡∏≤‡∏Å LLM ‡∏≠‡∏≤‡∏à "‡πÅ‡∏ï‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á" ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏¢‡∏∂‡∏î‡∏ï‡∏≤‡∏° context ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏°‡∏≤

### üéì Deep Dive: ‡∏ó‡∏≥‡πÑ‡∏°‡πÉ‡∏ä‡πâ Streaming?

```
‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà Streaming (‡∏£‡∏≠‡∏à‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à):
  ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ñ‡∏≤‡∏° ‚Üí [......‡∏£‡∏≠ 8 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ......] ‚Üí ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏õ‡∏£‡∏≤‡∏Å‡∏è
  ‚ùå ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏≤‡∏á

‡πÅ‡∏ö‡∏ö Streaming (‡∏ó‡∏µ‡∏•‡∏∞ token):
  ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ñ‡∏≤‡∏° ‚Üí [‡∏Å] [‡∏Å‡∏≤] [‡∏Å‡∏≤‡∏£] [‡∏Å‡∏≤‡∏£‡∏™] [‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ] [‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á]...
  ‚úÖ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÉ‡∏ô 0.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
  ‚úÖ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà AI ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
```

> üí° **UX Insight:** ‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏î‡πâ‡∏≤‡∏ô UX ‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡∏ñ‡∏∂‡∏á **3-5 ‡πÄ‡∏ó‡πà‡∏≤** ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ streaming ‡πÅ‡∏°‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏∞‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô ‚Äî ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏™‡∏°‡∏≠‡∏á‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå "‡πÑ‡∏°‡πà‡∏ä‡∏≠‡∏ö‡∏£‡∏≠" ‡πÅ‡∏ï‡πà "‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πâ‡∏≤" ‡∏ñ‡πâ‡∏≤‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ progress

### System Prompt Design

Prompt ‡∏ñ‡∏π‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡πâ AI **‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô** ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°:

```
‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢ ‚Üí ‡∏ï‡∏≠‡∏ö‡∏™‡∏±‡πâ‡∏ô‡∏ï‡∏£‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô
‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô ‚Üí ‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô, ‡∏Å‡∏£‡∏≠‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå)
‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå ‚Üí ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô ‚Üí ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏±‡∏Å‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô
‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‚Üí ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤
```

> üéì **Prompt Engineering Tip:** ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ AI "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ô‡πÉ‡∏à" (chain-of-thought) ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô

### Pipeline ‡πÉ‡∏ô generate()

```
query + search_results
    ‚îÇ
    ‚ñº _build_context()
    ‚îÇ ‚Üí ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö [‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà 1] (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á: 0.95)...
    ‚îÇ
    ‚ñº _build_prompt()
    ‚îÇ ‚Üí ‡∏£‡∏ß‡∏° query + context ‚Üí prompt
    ‚îÇ
    ‚ñº Gemini API (stream=True)
    ‚îÇ ‚Üí yield chunks ‡∏ó‡∏µ‡∏•‡∏∞ token
    ‚îÇ
    ‚ñº SSE ‚Üí Frontend
```

---

## 12. Core Package ‚Äî API Keys & Modules

‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `core/` ‡πÄ‡∏Å‡πá‡∏ö modules ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö LLM, API keys, ‡πÅ‡∏•‡∏∞ secrets

> üéì **‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô package?** ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ **Separation of Concerns (SoC)** ‚Äî ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ API keys ‡πÅ‡∏•‡∏∞ LLM ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏ó‡∏≥ RAG (search, chunk, embed) ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡πÑ‡∏ß‡πâ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô LLM ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° key ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô

### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á

```
core/
‚îú‚îÄ‚îÄ __init__.py             # Package init
‚îú‚îÄ‚îÄ config.py               # .env loader ‚Üí Settings singleton
‚îú‚îÄ‚îÄ key_manager.py          # Round-robin API key rotation
‚îú‚îÄ‚îÄ llm_generator.py        # Gemini generation (sync + streaming)
‚îî‚îÄ‚îÄ query_transformer.py    # HyDE + Query Rewriting (Groq)
```

### Config ‡πÅ‡∏¢‡∏Å 2 ‡∏£‡∏∞‡∏î‡∏±‡∏ö (Separation of Concerns)

| ‡πÑ‡∏ü‡∏•‡πå | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà | ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á |
|------|--------|--------|
| `config.py` (root) | RAG tuning parameters | CHUNK_SIZE, HYBRID_WEIGHT, RERANK_GAP |
| `core/config.py` | API keys & LLM settings | GEMINI_API_KEYS, TEMPERATURE |

> üéì **Singleton Pattern ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?** `core/config.py` ‡πÉ‡∏ä‡πâ Singleton ‚Äî Design Pattern ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ class ‡∏°‡∏µ instance ‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏±‡πà‡∏ß‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà import settings ‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô `.env` ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô

### Key Manager ‚Äî Round-Robin Rotation

```
Key Pool: [K1, K2, K3, K4, K5, K6, K7, K8, K9, K10]
                                                 ‚îÇ
Request 1 ‚Üí K1                                   ‚îÇ
Request 2 ‚Üí K2                                   ‚îÇ
Request 3 ‚Üí K3 ... ‚Üí Request 10 ‚Üí K10 ‚Üí K1 (‡∏ß‡∏ô‡∏ã‡πâ‡∏≥)
```

### üéì Deep Dive: Rate Limiting ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**Rate Limiting** ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ API ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô request ‡∏ï‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤:

```
1 Gemini API Key = ~15 requests/‡∏ô‡∏≤‡∏ó‡∏µ

‡∏ñ‡πâ‡∏≤‡∏°‡∏µ 1 key:   15 req/min ‚Üí ‡∏´‡∏°‡∏î‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡πÉ‡∏ä‡πâ
‡∏ñ‡πâ‡∏≤‡∏°‡∏µ 10 keys: 150 req/min ‚Üí ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏™‡∏ö‡∏≤‡∏¢

‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: Round-Robin ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢ request ‡πÑ‡∏õ‡∏ó‡∏∏‡∏Å key ‡πÄ‡∏ó‡πà‡∏≤‡πÜ ‡∏Å‡∏±‡∏ô
```

> üí° **‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö Tier ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£:** ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÉ‡∏´‡∏ç‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏á Google, OpenAI ‡πÉ‡∏ä‡πâ Rate Limit ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤ (‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ API tier ‡∏ü‡∏£‡∏µ) ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏≤‡∏¢ key ‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏ô‡∏¥‡∏¢‡∏°‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞ prototype

---

## 13. Web UI ‚Äî FastAPI + SSE

### ‡πÑ‡∏ü‡∏•‡πå: `web_server.py` + `web/`

Web UI ‡πÄ‡∏õ‡πá‡∏ô chat interface ‡πÅ‡∏ö‡∏ö dark theme ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö real-time streaming

### üéì Deep Dive: SSE vs WebSocket

| ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥ | SSE (‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ) | WebSocket |
|-----------|------------|----------|
| **‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á** | Server ‚Üí Client (stream) | 2 ‡∏ó‡∏≤‡∏á |
| **Protocol** | HTTP ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ | Protocol ‡πÅ‡∏¢‡∏Å |
| **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô** | ‡∏ô‡πâ‡∏≠‡∏¢‡∏°‡∏≤‡∏Å | ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏ß‡πà‡∏≤ |
| **Retry** | ‡∏°‡∏µ auto-reconnect | ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏≠‡∏á |
| **‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö** | Streaming ‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡πÄ‡∏ä‡πà‡∏ô AI chat) | Realtime 2 ‡∏ó‡∏≤‡∏á (‡πÄ‡∏ä‡πà‡∏ô game, chat) |

**‡∏ó‡∏≥‡πÑ‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å SSE?** ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏£‡∏∞‡∏ö‡∏ö RAG ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Ñ‡πà **server ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ client** (‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) ‚Äî SSE ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤ WebSocket ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ö‡∏ô HTTP ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ connection ‡∏û‡∏¥‡πÄ‡∏®‡∏©

> üí° ChatGPT, Claude, Gemini ‡∏•‡πâ‡∏ß‡∏ô‡πÉ‡∏ä‡πâ SSE ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ stream ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

### üéì Deep Dive: Async Architecture

`web_server.py` ‡πÉ‡∏ä‡πâ `asyncio.to_thread()` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ server ‡∏Ñ‡πâ‡∏≤‡∏á:

```
‡∏õ‡∏±‡∏ç‡∏´‡∏≤:
- RAG Search ‡πÉ‡∏ä‡πâ GPU + ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏´‡∏ô‡∏±‡∏Å (‡∏á‡∏≤‡∏ô CPU-bound)
- FastAPI ‡πÄ‡∏õ‡πá‡∏ô async (‡∏á‡∏≤‡∏ô I/O-bound)
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏Å search ‡∏ï‡∏£‡∏á‡πÜ ‚Üí server ‡∏à‡∏∞‡∏Ñ‡πâ‡∏≤‡∏á (‡∏£‡∏±‡∏ö request ‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)

‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:
- asyncio.to_thread(search) ‚Üí ‡∏¢‡πâ‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏Å‡πÑ‡∏õ thread ‡πÅ‡∏¢‡∏Å
- event loop ‡∏¢‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏±‡∏ö request ‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠ search ‡πÄ‡∏™‡∏£‡πá‡∏à ‚Üí ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô async context
```

### Technical Stack

| Component | Technology |
|-----------|----------|
| Backend | FastAPI + uvicorn |
| Streaming | SSE (Server-Sent Events) via sse-starlette |
| Frontend | Vanilla HTML/CSS/JS |
| Markdown | marked.js |
| Design | Dark theme + glassmorphism + Inter font |

> üéì **Glassmorphism ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?** ‡πÄ‡∏ó‡∏£‡∏ô‡∏î‡πå‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö UI ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ (frosted glass) ‡∏ú‡∏™‡∏° blur + ‡∏Ç‡∏≠‡∏ö‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÅ‡∏™‡∏á ‡∏ó‡∏≥‡πÉ‡∏´‡πâ UI ‡∏î‡∏π‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ‡πÉ‡∏ô CSS ‡πÉ‡∏ä‡πâ `backdrop-filter: blur()` + `background: rgba()` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á effect ‡∏ô‡∏µ‡πâ

### SSE Event Types

| Event | Data | ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞ |
|-------|------|--------|
| `status` | `{stage, message}` | ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞ stage |
| `hyde` | `{hyde_query, time}` | ‡∏´‡∏•‡∏±‡∏á HyDE ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à |
| `sources` | `{sources[], search_time}` | ‡∏´‡∏•‡∏±‡∏á Search ‡πÄ‡∏™‡∏£‡πá‡∏à |
| `token` | `{text}` | ‡∏ó‡∏∏‡∏Å token ‡∏ó‡∏µ‡πà Gemini ‡∏™‡∏£‡πâ‡∏≤‡∏á |
| `done` | `{hyde_time, search_time, gen_time, total_time}` | ‡∏à‡∏ö pipeline |

### API Endpoint

```
POST /api/ask
Body: { "query": "...", "use_hyde": true }
Response: SSE stream (event: status ‚Üí hyde ‚Üí sources ‚Üí token* ‚Üí done)
```

### Frontend Features

- üåô Dark theme + purple accent palette
- üí¨ Chat bubbles (user + AI)
- üìë Sources panel (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô + ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤)
- ‚è±Ô∏è Timing bar (HyDE / Search / Gen / Total)
- ü™Ñ HyDE toggle switch
- üí° Suggestion chips
- üì± Responsive design

---

## 14. ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà

```
RAG/
‚îú‚îÄ‚îÄ config.py               # ‚öôÔ∏è  Central config (paths, models, tuning)
‚îú‚îÄ‚îÄ rag_creator.py          # üî® Chunking + embedding + index building
‚îú‚îÄ‚îÄ rag_searcher.py         # üîç Hybrid search + adaptive reranking
‚îú‚îÄ‚îÄ build_index.py          # ‚ñ∂Ô∏è  CLI: build/rebuild index
‚îú‚îÄ‚îÄ search.py               # ‚ñ∂Ô∏è  CLI: interactive search (retrieval only)
‚îú‚îÄ‚îÄ ask.py                  # ü§ñ CLI: full RAG pipeline
‚îú‚îÄ‚îÄ web_server.py           # üåê FastAPI + SSE streaming server
‚îú‚îÄ‚îÄ test_rag.py             # ‚úÖ Test suite
‚îÇ
‚îú‚îÄ‚îÄ core/                   # üì¶ Core modules
‚îÇ   ‚îú‚îÄ‚îÄ config.py           #   üîê .env loader (API keys)
‚îÇ   ‚îú‚îÄ‚îÄ key_manager.py      #   üîë Round-robin key rotation
‚îÇ   ‚îú‚îÄ‚îÄ llm_generator.py    #   ü§ñ Gemini generation
‚îÇ   ‚îî‚îÄ‚îÄ query_transformer.py#   ü™Ñ HyDE + Query Rewriting
‚îÇ
‚îú‚îÄ‚îÄ web/                    # üé® Frontend
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îú‚îÄ‚îÄ style.css
‚îÇ   ‚îî‚îÄ‚îÄ app.js
‚îÇ
‚îú‚îÄ‚îÄ data/                   # üìÇ Source .jsonl files
‚îú‚îÄ‚îÄ storage/                # üíæ FAISS + BM25 indices
‚îî‚îÄ‚îÄ .env                    # üîê API keys
```

---

## 15. Configuration ‚Äî ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤

‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏¢‡∏Å config ‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏£‡∏∞‡∏î‡∏±‡∏ö:

### `config.py` (root) ‚Äî RAG Tuning

```python
# Hybrid Search weights (must sum to 1.0)
HYBRID_DENSE_WEIGHT = 0.7    # Semantic meaning
HYBRID_BM25_WEIGHT  = 0.3    # Keyword matching

# Adaptive Reranking
RERANK_SCORE_GAP = 0.15      # Skip reranker if gap > threshold

# Search tuning
TOP_K_RETRIEVAL = 10    # FAISS candidates
TOP_K_DISPLAY   = 5     # Final results shown
ENABLE_HYDE     = True  # HyDE query transform on/off
```

### `core/config.py` ‚Äî API Keys & LLM Settings

```python
# Environment Variables (via .env file)
GEMINI_API_KEYS     # Comma-separated Gemini API keys (10 keys)
GROQ_API_KEYS       # Comma-separated Groq API keys (3 keys)
GEMINI_MODEL        # Default: gemini-2.5-flash
GEMINI_TEMPERATURE  # Default: 0.3
GROQ_MODEL          # Default: llama-3.3-70b-versatile
GROQ_TEMPERATURE    # Default: 0.7
```

---

> üìÖ **Last Updated:** February 2025
> üìù **Author:** Auto-generated documentation
> üîñ **Version:** 2.0 ‚Äî Full RAG Pipeline (HyDE + Hybrid Search + Adaptive Reranking + Gemini Generation + Web UI)
